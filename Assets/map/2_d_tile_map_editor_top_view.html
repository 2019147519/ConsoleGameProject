<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>2D 콘솔 게임 맵 에디터</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1 { margin-bottom: 10px; }
    .controls { margin-bottom: 15px; }
    .controls label { margin-right: 20px; }
    .save-controls { margin-top: 15px; }
    .tile-selector button {
      margin-right: 5px; margin-bottom: 5px; padding: 6px 10px;
      cursor: pointer; border: 1px solid #333; color: #000;
    }
    .tile-btn-0 { background: #e0e0e0; }
    .tile-btn-1 { background: #444; color: #fff; }
    .tile-btn-2 { background: #c49a6c; }
    .tile-btn-3 { background: #3b6ea5; color: #fff; }
    .tile-btn-4 { background: #7dbb5a; }
    .tile-btn-5 { background: #e6d84a; }
    .tile-selector button.active { outline: 3px solid black; }
    #grid { display: grid; gap: 1px; margin-top: 15px; background: #444; width: fit-content; }
    .cell { width: 32px; height: 32px; cursor: pointer; }
    .tile-0 { background: #e0e0e0; }
    .tile-1 { background: #444; }
    .tile-2 { background: #c49a6c; }
    .tile-3 { background: #3b6ea5; }
    .tile-4 { background: #7dbb5a; }
    .tile-5 { background: #e6d84a; }
    textarea { width: 100%; height: 200px; margin-top: 20px; font-family: Consolas, monospace; }
  </style>
</head>
<body>
<h1>탑뷰 2D 콘솔 게임 맵 에디터</h1>

<div class="controls">
  <label>X:
    <input type="range" id="widthSlider" min="5" max="30" value="11" />
    <span id="widthValue">11</span>
  </label>
  <label>Y:
    <input type="range" id="heightSlider" min="5" max="30" value="11" />
    <span id="heightValue">11</span>
  </label>
</div>

<div class="tile-selector">
  <strong>타일 선택:</strong><br />
  <button data-tile="0" class="tile-btn-0 active">바닥</button>
  <button data-tile="1" class="tile-btn-1">벽</button>
  <button data-tile="2" class="tile-btn-2">상자</button>
  <button data-tile="3" class="tile-btn-3">문</button>
  <button data-tile="4" class="tile-btn-4">계단</button>
  <button data-tile="5" class="tile-btn-5">스위치</button>
</div>

<div id="grid"></div>

<div class="save-controls">
  <input type="text" id="fileName" placeholder="파일 이름 (예: stage1)" />
  <button id="saveBtn">저장</button>
</div>

<h2>C# 배열 출력</h2>
<textarea id="output" readonly></textarea>

<script>
const gridElement = document.getElementById('grid');
const outputElement = document.getElementById('output');
const widthSlider = document.getElementById('widthSlider');
const heightSlider = document.getElementById('heightSlider');
const widthValue = document.getElementById('widthValue');
const heightValue = document.getElementById('heightValue');
const tileButtons = document.querySelectorAll('.tile-selector button');
const saveBtn = document.getElementById('saveBtn');
const fileNameInput = document.getElementById('fileName');

let gridWidth = parseInt(widthSlider.value, 10);
let gridHeight = parseInt(heightSlider.value, 10);
let selectedTile = 0;
let mapData = [];
let isMouseDown = false;

function createMap() {
  mapData = Array.from({ length: gridHeight }, () =>
    Array.from({ length: gridWidth }, () => 0)
  );
}

function renderGrid() {
  gridElement.innerHTML = '';
  gridElement.style.gridTemplateColumns = `repeat(${gridWidth}, 32px)`;

  for (let y = 0; y < gridHeight; y++) {
    for (let x = 0; x < gridWidth; x++) {
      const cell = document.createElement('div');
      cell.className = `cell tile-${mapData[y][x]}`;

      const paint = () => {
        mapData[y][x] = selectedTile;
        cell.className = `cell tile-${selectedTile}`;
        updateOutput();
      };

      cell.addEventListener('mousedown', e => { e.preventDefault(); isMouseDown = true; paint(); });
      cell.addEventListener('mouseenter', () => { if (isMouseDown) paint(); });

      gridElement.appendChild(cell);
    }
  }
}

function updateOutput() {
  const lines = [];
  lines.push('int[,] map = new int[,]');
  lines.push('{');
  for (let y = 0; y < gridHeight; y++) {
    let row = '    { ' + mapData[y].join(', ') + ' }';
    if (y < gridHeight - 1) row += ',';
    lines.push(row);
  }
  lines.push('};');
  outputElement.value = lines.join('\n');
}

function rebuild() {
  gridWidth = parseInt(widthSlider.value, 10);
  gridHeight = parseInt(heightSlider.value, 10);
  widthValue.textContent = gridWidth;
  heightValue.textContent = gridHeight;
  createMap(); renderGrid(); updateOutput();
}

function saveFiles() {
  const name = fileNameInput.value.trim() || 'map';

  // 텍스트 저장
  const textBlob = new Blob([outputElement.value], { type: 'text/plain' });
  const textLink = document.createElement('a');
  textLink.href = URL.createObjectURL(textBlob);
  textLink.download = name + '.txt';
  textLink.click();

  // 이미지 저장
  const canvas = document.createElement('canvas');
  canvas.width = gridWidth * 32;
  canvas.height = gridHeight * 32;
  const ctx = canvas.getContext('2d');

  for (let y = 0; y < gridHeight; y++) {
    for (let x = 0; x < gridWidth; x++) {
      ctx.fillStyle = getTileColor(mapData[y][x]);
      ctx.fillRect(x * 32, y * 32, 32, 32);
    }
  }

  const imgLink = document.createElement('a');
  imgLink.href = canvas.toDataURL('image/png');
  imgLink.download = name + '.png';
  imgLink.click();
}

function getTileColor(tile) {
  return ['#e0e0e0','#444','#c49a6c','#3b6ea5','#7dbb5a','#e6d84a'][tile];
}

widthSlider.addEventListener('input', rebuild);
heightSlider.addEventListener('input', rebuild);
document.addEventListener('mouseup', () => isMouseDown = false);
saveBtn.addEventListener('click', saveFiles);

tileButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    tileButtons.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    selectedTile = parseInt(btn.dataset.tile, 10);
  });
});

rebuild();
</script>
</body>
</html>
